EOI EQU 20H
IMR EQU 21H
INT0 EQU 24H
PA EQU 30H
PB EQU 31H
CA EQU 32H
CB EQU 33H
F10 EQU 10

ORG 1000H
CANTCHAR DB 0
FIN DB 0
DATO DB ?

ORG 40
F10_DIR DW F10RUT

ORG 1500H
F10RUT: MOV AL,0FFH
OUT IMR, AL; DESABILITA TODAS LAS INTERRUPCIONES
MOV FIN,1; AVISA QUE TERMINO DE LEER LA CADENA
MOV AL,24H; AVISA QUE TERMINA LA INTERRUPCION
OUT EOI, AL
IRET


ORG 2000H
CLI
;CONFIGURO EL PIO
MOV AL, 0FDH ;FD=11111101
OUT CA, AL; HAGO TODOS LOS BITS DE ENTRADA MENOS EL DE STROBE
MOV AL,0; 0=00000000
OUT CB, AL; HAGO TODOS LOS BITS DE SALIDA PARA PODER MANDARLE EL DATO
IN AL, PA ;VEO EL ESTADO DE PA PARA MODIFICIAR EL BIT DE STROBE
AND AL, 0FDH; FUERZO A 0 EL BIT DE STROBE
OUT PA, AL

; CONFIGURO EL PIC
MOV AL,0FEH; FE = 1111 1110
OUT IMR,AL; ACTIVO LAS INTERRUPCIONES DEL F10
MOV AL, F10; LE PASO LA DIRECCION  DE LA SUBRUTINA AL PIC
OUT INT0, AL; LE PASO LA DIRECCION  DE LA SUBRUTINA AL REGISTRO INT0
STI


MOV BX, OFFSET DATO; LE PASO DONDE TIENE QUE GUARDAR EL DATO INGRESADO
MASDATOS: INT 6; LEO UN DATO
INC BX; INCREMENTO EL LUGAR DONDE SE VA A GUARDAR EL SIGUENTE DATO
INC CANTCHAR; AUMENTO LA CANTIDAD DE DATOS QUE TENGO EN LA CADENA
CMP FIN, 0; ME FIJO SI SE PRECIONO F10
JZ MASDATOS

MOV BX, OFFSET DATO; VUELVO A APUNTAR AL INICIO DE LA CADENA
POLL: IN AL, PA
AND AL, 1
JNZ POLL ;CONSULTO EL BIT DE BUSY PARA VER SI LA IMPRESORA ESTA OCUPADA
MOV AL,[BX]
OUT PB, AL; ENVIO EL DATO A LA IMPRESORA
IN AL, PA; COMPRUEBO EL ESTADO DE PA-COMIENZA EL PULSO
OR AL, 2; FUERZO EL BIT DE STROBE A 1 
OUT PA, AL
IN AL, PA ;COMPRUEBO EL ESTADO DE PA
AND AL, 0FDH; FUERZO EL BIT DE STROBE A 0 PARA GENERAR EL PULSO NECESARIO
OUT PA, AL; TERMINA EL PULSO- TERMINA EL PULSO
INC BX
DEC CANTCHAR; DECREMENTA CL PORQUE YA IMPRIMIO ESE DATO
JNZ POLL; SE FIJA SI TERMINO DE LEER LA CANTIDAD DE CARACTERES
INT 0
END