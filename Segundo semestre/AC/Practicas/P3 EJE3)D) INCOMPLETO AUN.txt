EOI EQU 20H
IMR EQU 21H
INT2 EQU 26H
HAND EQU 40H
ESTADO EQU 41H
IN_HAND EQU 10

ORG 40
DIR_HAND DW INT_HAND

ORG 3000H
INT_HAND: PUSH AX ; SALVO EL REGISTRO QUE VOY A USAR
MOV AL, [BX]; PREPARO EL DATO QUE TENGO QUE ENVIAR
OUT HAND, AL; ENVIO EL DATO AL HAND
CMP DL, 0; VEO SI TENGO QUE IR EN EL ARREGLO AL REVEZ O NO
JZ NORMAL
DEC BX; CONTINUO EN EL ARREGLO DE DATOS
JMP SIGO
NORMAL: INC BX
SIGO: DEC CL; BAJO LA CANTIDAD DE CARACTERES A IMPRIMIR
JNZ FIN; SI NO ES CERO CONTINUO, PERO SI ES
MOV AL, 0FFH; DESACTIVO LAS INTERRUPCIONES DEL HAND
OUT IMR, AL
FIN: MOV AL, EOI
OUT EOI, AL ;AVISO QUE TERMINO LA SUBRUTINA
POP AX; CARGO EL DATO QUE GUARDE
IRET


ORG 1000h
CANTCHAR DW 5
MSJ DB ?

ORG 2000h
MOV CL, CANTCHAR
MOV DL,0
MOV BX, OFFSET MSJ
MASDATOS: INT 6; LEO DATOS HASTA QUE SE TERMINE LA CANTIDAD
INC BX
DEC CANTCHAR; VEO SI NO HAY QUE CARGAR MAS DATOS
JNZ MASDATOS
MOV CANTCHAR, CL; GUARDO DE VUELTA LA CANTIDAD DE CARACTERES PARA LA VUELTA
MOV BX, OFFSET MSJ; VUELVO AL INICIO DEL ARREGLO
CLI
MOV AL, 0FBH; FB=11111011
OUT IMR, AL;HABILITO LAS INTERRUPCIONES DEL HAND
MOV AL, IN_HAND
OUT INT2, AL; LE PASO AL REGISTRO RELACIONADO CON EL HAND LA DIRECCION DE LA SUBRUTINA
MOV AL, 080H;CONFIGURO HANDSHAKE PARA INTERRUPCIONES
OUT ESTADO, AL
STI
LOOP: CMP CL,0; TERMINO LA CANTIDAD DE CARACTERES A IMPRIMIR?
JNZ LOOP
INC DL
CLI
MOV AL, 0FBH; FB=11111011
OUT IMR, AL;HABILITO LAS INTERRUPCIONES DEL HAND
MOV BX, OFFSET MSJ; VUELVO AL INICIO DEL ARREGLO
MOV CL, CANTCHAR; ENVIO LA CANTIDAD DE CARACTERES
DEC CANTCHAR
ADD BX, CANTCHAR; LLEVO BX AL FINAL DEL ARREGLO
STI
LOOP2: CMP CL,0
JNZ LOOP2
IN AL, ESTADO; VEO EL ESTADO DEL HAND
AND AL, 07FH; FUERZO EL BIT DE INTERRUPCIONES A CERO
OUT ESTADO, AL; ENVIO EL RESULTADO AL ESTADO
INT 0
END
